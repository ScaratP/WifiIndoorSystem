# Wi-Fi 室內定位系統

![Android](https://img.shields.io/badge/Platform-Android-3DDC84?logo=android)
![Kotlin](https://img.shields.io/badge/Language-Kotlin-0095D5?logo=kotlin)
![Compose](https://img.shields.io/badge/UI-Jetpack%20Compose-4285F4?logo=jetpack-compose)

## 📱 專案概述

Wi-Fi 室內定位系統是一個基於 Wi-Fi 訊號強度的室內位置識別應用程式。在 GPS 訊號無法有效覆蓋的室內環境中，本系統利用環境中的 Wi-Fi 訊號特徵建立「電子指紋」，實現高精度的室內位置確定。

## ✨ 核心功能

### 參考點管理
- **建立參考點**：在室內地圖上標記位置參考點，記錄對應的 Wi-Fi 訊號特徵
- **視覺化參考點**：參考點在地圖上以彩色標記顯示，直觀易讀
- **參考點詳情**：查看每個參考點的座標和收集的 Wi-Fi 訊號資料
- **批次收集**：支援多次掃描收集參考點的 Wi-Fi 訊號，提高精確度
- **追加模式**：可選擇保留舊的 Wi-Fi 資料並追加新的測量值
- **跨裝置共享**：支援匯出參考點資料為 JSON 格式，並在其他裝置上匯入使用

### 地圖功能
- **多地圖支援**：支援多層樓地圖切換，適用於複雜建築物
- **互動式地圖**：支援縮放、平移等手勢操作
- **直接標記**：透過點擊地圖直接建立新參考點
- **座標輸入**：可手動輸入精確座標位置
- **即時顯示**：參考點即時顯示在地圖上，帶有名稱標籤
- **檢視/編輯模式**：提供不同模式以便於查看或編輯參考點

### Wi-Fi 掃描與分析
- **自動掃描**：定期掃描環境中的 Wi-Fi 訊號
- **手動更新**：支援使用者手動觸發掃描更新
- **信號視覺化**：以色彩區分不同強度的 Wi-Fi 訊號
- **詳細資訊**：顯示 SSID、BSSID、訊號強度和頻率
- **數據統計**：提供平均值、最大值、最小值等多種數據分析模式

### 位置估算
- **即時定位**：根據當前 Wi-Fi 環境估算當前位置
- **準確度指示**：顯示位置估算的可信度級別，分為高、中、低三級
- **視覺反饋**：在地圖上清晰標示估算位置，使用不同顏色表示準確度
- **地圖自動選擇**：根據 Wi-Fi 環境自動判斷所在的樓層/地圖

### 資料管理
- **本地儲存**：使用 Room 資料庫安全儲存參考點和 Wi-Fi 資料
- **資料匯出**：將參考點資料匯出為 JSON 格式，方便備份和分析
- **資料匯入**：支援從 JSON 檔案匯入參考點資料，實現跨裝置共享
- **自訂檔案名稱**：使用者可以自訂匯出檔案的名稱
- **靈活儲存位置**：使用系統檔案選擇器選擇匯出檔案的儲存位置

## 🛠️ 技術規格

### 系統需求
- **作業系統**：Android 12.0 (API 31) 或更高版本
- **硬體要求**：支援 Wi-Fi 的 Android 裝置
- **權限**：位置權限 (用於 Wi-Fi 掃描)、儲存權限 (用於資料匯出)

### 開發技術
- **程式語言**：Kotlin
- **UI 框架**：Jetpack Compose 與 Material Design 3
- **資料儲存**：Room 資料庫
- **序列化**：JSON 處理
- **非同步處理**：Kotlin Coroutines
- **地圖互動**：TouchImageView 自定義實現
- **位置演算法**：加權 k-NN (k-最近鄰) 演算法

## 📋 使用指南

### 初次使用
1. 啟動應用程式時，系統會請求必要的位置權限
2. 授予權限後，您將看到主畫面，顯示目前的 Wi-Fi 環境

### 建立參考點
#### 方法 1：使用地圖
1. 切換到「地圖測試」分頁
2. 選擇適合的樓層/區域地圖
3. 開啟「編輯模式」開關
4. 在互動式地圖上，點擊您想要建立參考點的位置
5. 為參考點命名（或使用預設名稱）
6. 點擊「快速新增」完成建立

#### 方法 2：使用室內定位頁面
1. 在「室內定位」分頁點擊右下角的「+」按鈕
2. 輸入參考點名稱和 X、Y 座標值（百分比座標）
3. 設定掃描次數
4. 點擊「儲存參考點」完成建立

### 收集 Wi-Fi 資料
1. 在「室內定位」頁面點擊任一參考點查看詳情
2. 設定掃描次數和是否啟用追加模式
3. 點擊「開始收集 Wi-Fi 訊號」按鈕
4. 靜待收集完成，系統會顯示進度

### 使用互動地圖
1. 在地圖視圖中，您可以：
   - **縮放**：使用捏合手勢放大或縮小地圖
   - **平移**：拖動地圖移動視角
   - **切換地圖**：點擊頂部的地圖選項卡切換不同樓層/區域
   - **查看位置**：目前估算位置會以大圓圈顯示，顏色表示準確度
2. 在「編輯模式」下可直接點擊地圖新增參考點
3. 在「檢視模式」下可查看參考點詳情

### 匯出資料
1. 點擊「室內定位」頁面右上角的儲存圖示
2. 輸入要匯出的 JSON 檔案名稱
3. 透過系統檔案選擇器選擇儲存位置

### 匯入資料
1. 點擊「室內定位」頁面右上角的下載圖示
2. 點擊「選擇檔案」按鈕
3. 使用系統檔案選擇器選擇要匯入的 JSON 檔案
4. 等待資料匯入完成，成功後會顯示匯入的參考點數量

## 🧩 專案結構

- **MainActivity.kt**：應用程式入口點和主要分頁結構
- **IndoorPositioningScreen.kt**：室內定位功能的UI和邏輯
- **WifiScanner.kt**：Wi-Fi掃描功能的UI和邏輯
- **MapScreen.kt**：地圖顯示和參考點標記功能
- **DataModels.kt**：
  - ReferencePoint：參考點資料結構
  - WifiReading：Wi-Fi讀數資料結構
  - ReferencePointDatabase：參考點資料庫管理類
  - CurrentPosition：當前位置資料結構

## 📈 定位演算法

本系統使用加權 k-NN (k-最近鄰) 演算法進行位置估算：

1. 收集當前環境的 Wi-Fi 訊號特徵
2. 計算當前訊號與所有參考點訊號的相似度 (歐幾里德距離)
3. 選擇相似度最高的 K 個參考點 (默認 K=5)
4. 根據相似度為每個參考點分配權重
5. 計算加權平均位置作為最終估算結果
6. 根據權重分布計算位置準確度指標

## ⚠️ 注意事項

- 此應用程式需要位置權限才能掃描Wi-Fi網路，這是Android系統的要求
- Wi-Fi掃描功能可能會增加電池耗電量
- 參考點資料僅儲存在裝置上，建議定期匯出以防資料遺失
- 定位精度受參考點數量和Wi-Fi環境穩定性影響
- 建議在每個區域標記足夠數量的參考點，以提高定位準確度
